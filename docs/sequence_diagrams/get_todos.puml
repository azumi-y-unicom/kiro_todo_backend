@startuml get_todos
title 全ToDoアイテム取得シーケンス

actor Client as C
participant "FastAPI\n(Router)" as API
participant "TodoService\n(Business Logic)" as Service
participant "TodoRepository\n(Data Access)" as Repo
database "PostgreSQL\n(Database)" as DB

C -> API: GET /todos
activate API

API -> Service: get_all_todos()
activate Service

Service -> Repo: get_all()
activate Repo

Repo -> DB: SELECT * FROM todos\nORDER BY created_at DESC
activate DB
DB --> Repo: ToDoレコードリスト
deactivate DB

Repo --> Service: List[TodoModel]
deactivate Repo

Service --> API: List[TodoModel]
deactivate Service

API -> API: Response serialization\n(List[TodoResponse])
API --> C: 200 OK\n[{todo1}, {todo2}, ...]
deactivate API

note over C, DB: 正常系: 全てのToDoアイテムが取得される

== エラーケース ==

C -> API: GET /todos
activate API
API -> Service: get_all_todos()
activate Service
Service -> Repo: get_all()
activate Repo
Repo -> DB: SELECT query
activate DB
DB --> Repo: Database connection error
deactivate DB
Repo --> Service: Exception
deactivate Repo
Service --> API: Exception
deactivate Service
API --> C: 500 Internal Server Error\n{error message}
deactivate API

== 空のリストケース ==

C -> API: GET /todos
activate API
API -> Service: get_all_todos()
activate Service
Service -> Repo: get_all()
activate Repo
Repo -> DB: SELECT * FROM todos
activate DB
DB --> Repo: 空のリスト
deactivate DB
Repo --> Service: []
deactivate Repo
Service --> API: []
deactivate Service
API --> C: 200 OK\n[]
deactivate API

@enduml