@startuml get_todo_by_id
title 特定ToDoアイテム取得シーケンス

actor Client as C
participant "FastAPI\n(Router)" as API
participant "TodoService\n(Business Logic)" as Service
participant "TodoRepository\n(Data Access)" as Repo
database "PostgreSQL\n(Database)" as DB

C -> API: GET /todos/id
activate API

API -> API: パスパラメータ検証\n(id: int)
note right: パスパラメータの\n型チェック

API -> Service: get_todo_by_id(todo_id)
activate Service

Service -> Repo: get_by_id(todo_id)
activate Repo

Repo -> DB: SELECT * FROM todos\nWHERE id = todo_id
activate DB
DB --> Repo: ToDoレコード
deactivate DB

Repo --> Service: TodoModel
deactivate Repo

Service --> API: TodoModel
deactivate Service

API -> API: レスポンスシリアライゼーション\n(TodoResponse schema)
API --> C: 200 OK\n(id, title, description, completed, created_at, updated_at)
deactivate API

note over C, DB: 正常系: 指定されたToDoアイテムが取得される

== ToDoが見つからないケース ==

C -> API: GET /todos/non_existent_id
activate API
API -> Service: get_todo_by_id(non_existent_id)
activate Service
Service -> Repo: get_by_id(non_existent_id)
activate Repo
Repo -> DB: SELECT * FROM todos\nWHERE id = non_existent_id
activate DB
DB --> Repo: None (レコードなし)
deactivate DB
Repo --> Service: None
deactivate Repo
Service --> API: HTTPException(404)
deactivate Service
API --> C: 404 Not Found\n"detail: Todo not found"
deactivate API

== 無効なIDケース ==

C -> API: GET /todos/invalid_id
activate API
API -> API: パスパラメータ検証エラー
API --> C: 422 Unprocessable Entity\nvalidation errors
deactivate API

== データベースエラーケース ==

C -> API: GET /todos/id
activate API
API -> Service: get_todo_by_id(todo_id)
activate Service
Service -> Repo: get_by_id(todo_id)
activate Repo
Repo -> DB: SELECT query
activate DB
DB --> Repo: データベースエラー
deactivate DB
Repo --> Service: Exception
deactivate Repo
Service --> API: Exception
deactivate Service
API --> C: 500 Internal Server Error\nerror message
deactivate API

@enduml